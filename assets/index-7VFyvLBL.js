(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const r of t)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function a(t){const r={};return t.integrity&&(r.integrity=t.integrity),t.referrerPolicy&&(r.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?r.credentials="include":t.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(t){if(t.ep)return;t.ep=!0;const r=a(t);fetch(t.href,r)}})();const $="modulepreload",B=function(e,s){return new URL(e,s).href},b={},_=function(s,a,o){let t=Promise.resolve();if(a&&a.length>0){let m=function(l){return Promise.all(l.map(n=>Promise.resolve(n).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};const i=document.getElementsByTagName("link"),c=document.querySelector("meta[property=csp-nonce]"),f=c?.nonce||c?.getAttribute("nonce");t=m(a.map(l=>{if(l=B(l,o),l in b)return;b[l]=!0;const n=l.endsWith(".css"),p=n?'[rel="stylesheet"]':"";if(o)for(let h=i.length-1;h>=0;h--){const w=i[h];if(w.href===l&&(!n||w.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${p}`))return;const d=document.createElement("link");if(d.rel=n?"stylesheet":$,n||(d.as="script"),d.crossOrigin="",d.href=l,f&&d.setAttribute("nonce",f),document.head.appendChild(d),n)return new Promise((h,w)=>{d.addEventListener("load",h),d.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${l}`)))})}))}function r(i){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=i,window.dispatchEvent(c),!c.defaultPrevented)throw i}return t.then(i=>{for(const c of i||[])c.status==="rejected"&&r(c.reason);return s().catch(r)})},R={quality:75,target_size:0,target_PSNR:0,method:4,sns_strength:50,filter_strength:60,filter_sharpness:0,filter_type:1,partitions:0,segments:4,pass:1,show_compressed:0,preprocessing:0,autofilter:0,partition_limit:0,alpha_compression:1,alpha_filtering:1,alpha_quality:100,lossless:0,exact:0,image_hint:0,emulate_jpeg_size:0,thread_level:0,low_memory:0,near_lossless:100,use_delta_palette:0,use_sharp_yuv:0};function L(e,s,a={}){let o;return s&&(o=(t,r)=>{const i=new WebAssembly.Instance(s,t);return r(i),i.exports}),e({noInitialRun:!0,instantiateWasm:o,...a})}const O=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11]));let y;async function W(e,s){let a=e,o=s;if(arguments.length===1&&!(e instanceof WebAssembly.Module)&&(a=void 0,o=e),await O()){const r=await _(()=>import("./webp_enc_simd-CAFyfE9_.js"),[],import.meta.url);return y=L(r.default,a,o),y}const t=await _(()=>import("./webp_enc-2l0OY9rs.js"),[],import.meta.url);return y=L(t.default,a,o),y}async function k(e,s={}){y||(y=W());const a={...R,...s},t=(await y).encode(e.data,e.width,e.height,a);if(!t)throw new Error("Encoding error.");return t.buffer}function q(e={}){const{immediate:s=!1,onNeedRefresh:a,onOfflineReady:o,onRegistered:t,onRegisteredSW:r,onRegisterError:i}=e;let c,f;const m=async(n=!0)=>{await f};async function l(){if("serviceWorker"in navigator){if(c=await _(async()=>{const{Workbox:n}=await import("./workbox-window.prod.es5-BIl4cyR9.js");return{Workbox:n}},[],import.meta.url).then(({Workbox:n})=>new n("./sw.js",{scope:"./",type:"classic"})).catch(n=>{i?.(n)}),!c)return;c.addEventListener("activated",n=>{(n.isUpdate||n.isExternal)&&window.location.reload()}),c.addEventListener("installed",n=>{n.isUpdate||o?.()}),c.register({immediate:s}).then(n=>{r?r("./sw.js",n):t?.(n)}).catch(n=>{i?.(n)})}}return f=l(),m}q({immediate:!0});const v=document.getElementById("dropZone"),x=document.getElementById("uploadInput"),A=document.getElementById("dropText"),I=document.getElementById("preview"),C=document.getElementById("placeholderText"),E=document.getElementById("metaInfo"),g=document.getElementById("saveBtn");let u=null;v.addEventListener("click",()=>x.click());["dragenter","dragover","dragleave","drop"].forEach(e=>{v.addEventListener(e,T,!1)});function T(e){e.preventDefault(),e.stopPropagation()}["dragenter","dragover"].forEach(()=>{v.classList.add("highlight")});["dragleave","drop"].forEach(()=>{v.classList.remove("highlight")});v.addEventListener("drop",e=>{const a=e.dataTransfer.files;a.length>0&&P(a[0])});x.addEventListener("change",e=>{e.target.files.length>0&&P(e.target.files[0])});function P(e){if(!e.type.startsWith("image/")){alert("画像ファイルのみ対応しています");return}u=e,A.textContent=`選択中: ${u.name}`,S()}document.querySelectorAll('input[type="radio"]').forEach(e=>{e.addEventListener("change",()=>{u&&S()})});async function S(){if(u){E.textContent="変換中...",g.classList.remove("active"),g.style.backgroundColor="#ccc";try{const e=parseInt(document.querySelector('input[name="width"]:checked').value),s=parseInt(document.querySelector('input[name="quality"]:checked').value),a=await createImageBitmap(u);let o=a.width,t=a.height;o>e&&(t=Math.round(t*(e/o)),o=e);const r=document.createElement("canvas");r.width=o,r.height=t;const i=r.getContext("2d");i.imageSmoothingEnabled=!0,i.imageSmoothingQuality="high",i.drawImage(a,0,0,o,t);const c=i.getImageData(0,0,o,t),f=await k(c,{quality:s,method:4}),m=new Blob([f],{type:"image/webp"}),l=URL.createObjectURL(m);I.src=l,I.style.display="block",C.style.display="none";const n=(u.size/1024).toFixed(1),p=(m.size/1024).toFixed(1),d=Math.round((1-m.size/u.size)*100);E.innerHTML=`
            元: ${n} KB<br>
            ↓<br>
            <span class="size-highlight">${p} KB</span> (-${d}%)<br>
            サイズ: ${o} x ${t} px / 画質: ${s}
        `;const h=u.name.replace(/\.[^.]+$/,"");g.href=l,g.download=`${h}_${e}w_q${s}.webp`,g.textContent="画像を保存する",g.classList.add("active"),g.style.backgroundColor="#007bff"}catch(e){console.error(e),E.textContent="エラーが発生しました。別の画像を試してください。"}}}
