(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))s(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function c(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(t){if(t.ep)return;t.ep=!0;const n=c(t);fetch(t.href,n)}})();const S="modulepreload",O=function(e,r){return new URL(e,r).href},_={},v=function(r,c,s){let t=Promise.resolve();if(c&&c.length>0){let m=function(l){return Promise.all(l.map(o=>Promise.resolve(o).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};const i=document.getElementsByTagName("link"),a=document.querySelector("meta[property=csp-nonce]"),u=a?.nonce||a?.getAttribute("nonce");t=m(c.map(l=>{if(l=O(l,s),l in _)return;_[l]=!0;const o=l.endsWith(".css"),d=o?'[rel="stylesheet"]':"";if(s)for(let y=i.length-1;y>=0;y--){const w=i[y];if(w.href===l&&(!o||w.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${d}`))return;const f=document.createElement("link");if(f.rel=o?"stylesheet":S,o||(f.as="script"),f.crossOrigin="",f.href=l,u&&f.setAttribute("nonce",u),document.head.appendChild(f),o)return new Promise((y,w)=>{f.addEventListener("load",y),f.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${l}`)))})}))}function n(i){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=i,window.dispatchEvent(a),!a.defaultPrevented)throw i}return t.then(i=>{for(const a of i||[])a.status==="rejected"&&n(a.reason);return r().catch(n)})},R={quality:75,target_size:0,target_PSNR:0,method:4,sns_strength:50,filter_strength:60,filter_sharpness:0,filter_type:1,partitions:0,segments:4,pass:1,show_compressed:0,preprocessing:0,autofilter:0,partition_limit:0,alpha_compression:1,alpha_filtering:1,alpha_quality:100,lossless:0,exact:0,image_hint:0,emulate_jpeg_size:0,thread_level:0,low_memory:0,near_lossless:100,use_delta_palette:0,use_sharp_yuv:0};function b(e,r,c={}){let s;return r&&(s=(t,n)=>{const i=new WebAssembly.Instance(r,t);return n(i),i.exports}),e({noInitialRun:!0,instantiateWasm:s,...c})}const x=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11]));let p;async function N(e,r){let c=e,s=r;if(arguments.length===1&&!(e instanceof WebAssembly.Module)&&(c=void 0,s=e),await x()){const n=await v(()=>import("./webp_enc_simd-CAFyfE9_.js"),[],import.meta.url);return p=b(n.default,c,s),p}const t=await v(()=>import("./webp_enc-2l0OY9rs.js"),[],import.meta.url);return p=b(t.default,c,s),p}async function A(e,r={}){p||(p=N());const c={...R,...r},t=(await p).encode(e.data,e.width,e.height,c);if(!t)throw new Error("Encoding error.");return t.buffer}function W(e={}){const{immediate:r=!1,onNeedRefresh:c,onOfflineReady:s,onRegistered:t,onRegisteredSW:n,onRegisterError:i}=e;let a,u;const m=async(o=!0)=>{await u};async function l(){if("serviceWorker"in navigator){if(a=await v(async()=>{const{Workbox:o}=await import("./workbox-window.prod.es5-BIl4cyR9.js");return{Workbox:o}},[],import.meta.url).then(({Workbox:o})=>new o("./sw.js",{scope:"./",type:"classic"})).catch(o=>{i?.(o)}),!a)return;a.addEventListener("activated",o=>{(o.isUpdate||o.isExternal)&&window.location.reload()}),a.addEventListener("installed",o=>{o.isUpdate||s?.()}),a.register({immediate:r}).then(o=>{n?n("./sw.js",o):t?.(o)}).catch(o=>{i?.(o)})}}return u=l(),m}W({immediate:!0});const L=document.getElementById("uploadInput"),g=document.getElementById("dropZone"),P=document.getElementById("result-container"),h=document.getElementById("statusMessage");let E=[];g.addEventListener("click",()=>L.click());const $=e=>{e.preventDefault(),e.stopPropagation()};["dragenter","dragover","dragleave","drop"].forEach(e=>{g.addEventListener(e,$,!1)});g.addEventListener("dragover",()=>g.classList.add("highlight"));["dragleave","drop"].forEach(()=>g.classList.remove("highlight"));g.addEventListener("drop",e=>{const r=Array.from(e.dataTransfer.files);I(r)});L.addEventListener("change",e=>{const r=Array.from(e.target.files);I(r)});const q=document.querySelectorAll('input[type="radio"]');q.forEach(e=>{e.addEventListener("change",()=>{E.length>0&&C(E)})});function I(e){const r=e.filter(c=>c.type.startsWith("image/"));r.length!==0&&(E=r,C(E))}async function C(e){const r=document.querySelector('input[name="width"]:checked').value,c=parseInt(document.querySelector('input[name="quality"]:checked').value);h.style.display="block",h.textContent="Wasmモジュール準備中...",P.innerHTML="";for(let s=0;s<e.length;s++){const t=e[s];h.textContent=`変換中... (${s+1} / ${e.length}): ${t.name}`,await new Promise(n=>setTimeout(n,10)),await M(t,r,c)}h.textContent="完了しました！",setTimeout(()=>{h.style.display="none"},2e3)}async function M(e,r,c){try{const s=await createImageBitmap(e);let t=s.width,n=s.height;if(r!=="original"){const d=parseInt(r);t>d&&(n=Math.round(n*(d/t)),t=d)}const i=document.createElement("canvas");i.width=t,i.height=n;const a=i.getContext("2d");a.imageSmoothingEnabled=!0,a.imageSmoothingQuality="high",a.drawImage(s,0,0,t,n);const u=a.getImageData(0,0,t,n),m=await A(u,{quality:c,method:4}),l=new Blob([m],{type:"image/webp"}),o=URL.createObjectURL(l);k(o,e,l,t,n)}catch(s){console.error("Conversion Error:",s),h.textContent=`エラー: ${e.name}`}}function k(e,r,c,s,t){const n=document.createElement("div");n.className="img-card";const i=document.createElement("img");i.src=e;const a=document.createElement("p");a.className="file-name";const u=r.name.replace(/\.[^.]+$/,"")+".webp";a.textContent=u;const m=document.createElement("p");m.className="file-size";const l=(c.size/1024).toFixed(1),o=Math.round((1-c.size/r.size)*100);m.innerHTML=`${l} KB <span style="color:#d63384">(-${o}%)</span>`;const d=document.createElement("a");d.href=e,d.download=u,d.className="download-btn",d.textContent="保存",n.appendChild(i),n.appendChild(a),n.appendChild(m),n.appendChild(d),P.appendChild(n)}
