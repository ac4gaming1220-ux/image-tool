(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const i of t.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function c(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function o(e){if(e.ep)return;e.ep=!0;const t=c(e);fetch(e.href,t)}})();const C="modulepreload",I=function(n,s){return new URL(n,s).href},v={},E=function(s,c,o){let e=Promise.resolve();if(c&&c.length>0){let m=function(l){return Promise.all(l.map(r=>Promise.resolve(r).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};const i=document.getElementsByTagName("link"),a=document.querySelector("meta[property=csp-nonce]"),u=a?.nonce||a?.getAttribute("nonce");e=m(c.map(l=>{if(l=I(l,o),l in v)return;v[l]=!0;const r=l.endsWith(".css"),d=r?'[rel="stylesheet"]':"";if(o)for(let g=i.length-1;g>=0;g--){const w=i[g];if(w.href===l&&(!r||w.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${d}`))return;const f=document.createElement("link");if(f.rel=r?"stylesheet":C,r||(f.as="script"),f.crossOrigin="",f.href=l,u&&f.setAttribute("nonce",u),document.head.appendChild(f),r)return new Promise((g,w)=>{f.addEventListener("load",g),f.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${l}`)))})}))}function t(i){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=i,window.dispatchEvent(a),!a.defaultPrevented)throw i}return e.then(i=>{for(const a of i||[])a.status==="rejected"&&t(a.reason);return s().catch(t)})},O={quality:75,target_size:0,target_PSNR:0,method:4,sns_strength:50,filter_strength:60,filter_sharpness:0,filter_type:1,partitions:0,segments:4,pass:1,show_compressed:0,preprocessing:0,autofilter:0,partition_limit:0,alpha_compression:1,alpha_filtering:1,alpha_quality:100,lossless:0,exact:0,image_hint:0,emulate_jpeg_size:0,thread_level:0,low_memory:0,near_lossless:100,use_delta_palette:0,use_sharp_yuv:0};function _(n,s,c={}){let o;return s&&(o=(e,t)=>{const i=new WebAssembly.Instance(s,e);return t(i),i.exports}),n({noInitialRun:!0,instantiateWasm:o,...c})}const R=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11]));let p;async function S(n,s){let c=n,o=s;if(arguments.length===1&&!(n instanceof WebAssembly.Module)&&(c=void 0,o=n),await R()){const t=await E(()=>import("./webp_enc_simd-CAFyfE9_.js"),[],import.meta.url);return p=_(t.default,c,o),p}const e=await E(()=>import("./webp_enc-2l0OY9rs.js"),[],import.meta.url);return p=_(e.default,c,o),p}async function x(n,s={}){p||(p=S());const c={...O,...s},e=(await p).encode(n.data,n.width,n.height,c);if(!e)throw new Error("Encoding error.");return e.buffer}function N(n={}){const{immediate:s=!1,onNeedRefresh:c,onOfflineReady:o,onRegistered:e,onRegisteredSW:t,onRegisterError:i}=n;let a,u;const m=async(r=!0)=>{await u};async function l(){if("serviceWorker"in navigator){if(a=await E(async()=>{const{Workbox:r}=await import("./workbox-window.prod.es5-BIl4cyR9.js");return{Workbox:r}},[],import.meta.url).then(({Workbox:r})=>new r("./sw.js",{scope:"./",type:"classic"})).catch(r=>{i?.(r)}),!a)return;a.addEventListener("activated",r=>{(r.isUpdate||r.isExternal)&&window.location.reload()}),a.addEventListener("installed",r=>{r.isUpdate||o?.()}),a.register({immediate:s}).then(r=>{t?t("./sw.js",r):e?.(r)}).catch(r=>{i?.(r)})}}return u=l(),m}N({immediate:!0});const b=document.getElementById("uploadInput"),h=document.getElementById("dropZone"),L=document.getElementById("result-container"),y=document.getElementById("statusMessage");h.addEventListener("click",()=>b.click());const W=n=>{n.preventDefault(),n.stopPropagation()};["dragenter","dragover","dragleave","drop"].forEach(n=>{h.addEventListener(n,W,!1)});h.addEventListener("dragover",()=>h.classList.add("highlight"));["dragleave","drop"].forEach(()=>h.classList.remove("highlight"));h.addEventListener("drop",n=>P(n.dataTransfer.files));b.addEventListener("change",n=>P(n.target.files));async function P(n){if(n.length===0)return;const s=document.querySelector('input[name="width"]:checked').value,c=parseInt(document.querySelector('input[name="quality"]:checked').value);y.style.display="block",y.textContent="Wasmモジュール準備中...",L.innerHTML="";for(let o=0;o<n.length;o++){const e=n[o];e.type.startsWith("image/")&&(y.textContent=`変換中... (${o+1} / ${n.length}): ${e.name}`,await new Promise(t=>setTimeout(t,10)),await $(e,s,c))}y.textContent="すべての処理が完了しました！",setTimeout(()=>{y.style.display="none"},3e3)}async function $(n,s,c){try{const o=await createImageBitmap(n);let e=o.width,t=o.height;if(s!=="original"){const d=parseInt(s);e>d&&(t=Math.round(t*(d/e)),e=d)}const i=document.createElement("canvas");i.width=e,i.height=t;const a=i.getContext("2d");a.imageSmoothingEnabled=!0,a.imageSmoothingQuality="high",a.drawImage(o,0,0,e,t);const u=a.getImageData(0,0,e,t),m=await x(u,{quality:c,method:4}),l=new Blob([m],{type:"image/webp"}),r=URL.createObjectURL(l);k(r,n,l,e,t)}catch(o){console.error("Conversion Error:",o),alert(`${n.name} の変換中にエラーが発生しました。`)}}function k(n,s,c,o,e){const t=document.createElement("div");t.className="img-card";const i=document.createElement("img");i.src=n;const a=document.createElement("p");a.className="file-name";const u=s.name.replace(/\.[^.]+$/,"")+".webp";a.textContent=u;const m=document.createElement("p");m.className="file-size";const l=(c.size/1024).toFixed(1),r=Math.round((1-c.size/s.size)*100);m.textContent=`${l} KB (-${r}%)`;const d=document.createElement("a");d.href=n,d.download=u,d.className="download-btn",d.textContent="保存",t.appendChild(i),t.appendChild(a),t.appendChild(m),t.appendChild(d),L.appendChild(t)}
